---
layout: page
title: "问题"
header-img: "img/green.jpg"
---

## -----------------------------------问题纪要----------------------------


***
### P升R casper升级后部分软件不能搜台问题【2022-08-1】
***
* 问题分析
    > 前期因为代码框架不成熟，中间修改了数据结构框架，导致搜台逻辑发生变化，OTA新软件后，导致前期软件不能搜台，android P的OTA临时措施增加开机向导，重写数据结构，但因为andnroidR跟androidP代码结构也不一样
* 解决方法 
    > *  在Factory app 启动后做一个shop 把数据删除，直接调用FactoryAdapter factoryManager.restoreToDefault(mContext)方法
    > *  做一个SP标识，只有第一次启Shop，下次启动不再做shop动作



***
### 六合一的板，一连串口工具通信直接就重启【2022-07-4】
***

* Mantis ID号
    >  125909
* 问题分析
    > 自动化反馈软件一连串口工具发任何指令，TV会直接重启。刚开始以为是后面以为是软件问题，通过抓日志，并没有发现在异常。怀疑是系统出了问题，把日志给到系统组分析也没有发现在异常，怀疑是RTK是否改到串口逻辑。后面发现用串口直接挂在Impdata目录也会直接重启。以为是软件有问题，换了一个其它时间的软件结果还是一样。但发现在拿其它的型号的板并没有这个问题。然后拿一个最旧的软件发现是正常。后面只能通过夹版找到了4月14号的软件正常，4月15号的异常，对比找到14号提交的code ，回退编译最终确定一个RTK的一笔Google远场语音的code影响的。主要是硬件远场USB上错了电阻，导致Google远场语音调用会用到这个电阻。
* 解决方法 
    > *  更换远场USB。
    > *  已出板的因未用到Google远场语音只能通过回退这笔code升级新软件。

***
### DTV节目有图像无声音，mp3,ac3 等video也没有声音【2022-06-21】
***

* Mantis ID号
    >  0125519
* 问题分析
    >  SQA反馈41A电视shop后开机，在开机向导下选择all搜台，再选择cable通道搜台，结束后切到antenna通道播放5.1节目有图像无声音，初步猜测是RMCA key 不正常，但是进入mnt/vendor/impdata 下查看RMCA_ready md5值正常，41A只有一个RMCA key mnt/vendor/factory 下RMCA 也存在。之前[2022-04-22]号赵龙边也出现过类似问题，是factory RMCA key 未生效，重新U盘抄同一个RMCA 按理说同一台机器，同一个key， factory 分区下的RMCA key md5值应该是同一个，但之前的问题两个key的md5值不一样，U盘重抄正常，有声音，所以第一次factory 分区RMCA key 有问题。而这一次重抄后依然有问题，而 widevine 、playready key抄写失败。跟RTK 分析是换了IC 或都EMMMC 导致key不生效。
* 检测是否更换了IC 或都EMMMC日志
    > * cd /mnt/vendor/rtdlog/ 
    > * cat rtd_kcpu.log
    > * 是否有日志显示Verify key fail, rpmb secure key not match
* 解决方法 
    >  重新更换IC或者新的EMMC，然后重新抄key


***
### 松下菲律宾项目工厂菜单预置HZ工厂频道失败【2022-06-20】
***

* 问题分析
    > 松下菲律宾生产适应性反馈预制惠州工厂频道无效果，显示没有台，进入TV 还是显示要搜台。通过shop，重新预置HZ都没台，在daillyBuild版本预置正常。通过排查发现在daillyBuild发现是用的Moka设置界面，而客户用的是公版设置界面，通过对比制式，发现预制db只有provider_db而没有rtk_provider_db。   
* 解决方法 
    > 在公版上搜台，把db导出来，重新提交rtk_provider_db


***
### 工厂菜单Shop会弹出googe 相关的界面覆盖工厂绿色界面，而且遥控器无法使用【2022-06-16】
***

* 问题分析
    >  测试时发现在工厂菜单Shop后会弹出google 相关的界面，如google 登录、google TV、网络连接等界面，而且遥控器无法使用，遥控器无法使用是应该工厂菜单Shop后会屏蔽遥控器按键，这属于正常。之所以会弹出google相关界面，首先是登录了google账号，然后在shop之后会把google 账号清除，而与google 账号登录相关联的应用发现在google 账号被清后会再次尝试连接，并弹出相关的提示界面。   
* 解决方法 
    > * 此问题不影响工厂生产，工厂不会登录gogole. 
    > * 如果登录了google 账号，先google reset 后再去工厂做shop


***
### 日规预制频道无法播放，需要更换地波码流【2022-06-10】
***

* 问题分析
    > 试产线观察现象，JP008_NHK統合・大阪2019040430.ts无法播放，切换到NHK27(-t).ts正常。     
* 解决方法 
    > * 更换地波码流为NHK27(-t).ts. 
    > * 修改tr_preset_channel.json 和tr_preset_service.json 文件
    > * 修改tr_preset_channel.json 中的original_network_id 和ts_id 为要修改码流分析器出来的NIT -> tableId ->network_id值十六进制改10进制即可
    > * 修改tr_preset_service.json 中的service_id 值为要修改码流分析器出来Sservice_descriptions lop 下几个对应的service_id值十六进制改10进制即可
* 修改路径 
    > kernel/android/R/device/tv051/R4/custom_images/tclconfig/preset_channel/jp
* 总结 
    > 日规自己手动更改地波码流


### 【试产问题】串口命令开启100%内置白场后，再发送亮度或者对比度100的指令，画面会变灰【2021-07-22】
***

* 问题分析
    > 试产线观察现象，一开始试产报的问题是白平衡调试NG，后面下去分析才发现是最大亮度调不过，经过模拟，定位到开启内置白场后，在发送亮度或者对比度的指令，整个画面会变灰，导致最大亮度测试NG        
* 解决方法 
    > 修改scalercolorlib_IPQ.c 
* 修改路径 
    > kernel/linux-kdriver2.git /tvscalercontrol/scaler
* 总结 
    >  7月份的试产才报出问题，之前试产批次都未测试最大亮度，新机芯自测白平衡时，需要勾选最大亮度

***
### 【贴板问题】赵龙反馈41A试做的几个贴板DTV 有画面但是没有声音的问题【2022-04-22】
***


* 问题分析
    > 赵龙的41A几片贴板发现DTV有视频画面，但是没有声音，发现impdata 目录下的RMCA_ready也正常，最但是用U盘从新抄相同的RMCA key 后又正常有声音，同一个软件件升级到另一台机器又正常的，最后定位为板卡上的 vendor/factory 加密分区的RMCA key md5值，与重抄的加密Md5值不一样导致的。同一台机器，同一个RMCA 加密分区的RMCA 值应该是一样的。
* 解决方法 
    > 查找为什么第一次RMCA 值不一样。
 
***
### 【试产问题】泰霖反抄软件升级后在不用遥控器切的情况下，第一次启用串口切DTV，无法切到DTV目录下，用遥控器切一次DTV后，用串口能正常切【2022-03-22】
***

* 问题分析
    > 根据分析发现只有升级第一次用串口切DTV 会有会问题，切不过。后面发现用遥控器切，发现第一次切DTV 的频道台号为800，第二次切发现台号变成了1.跟据这个现象，定位到预置DB频道默认是为1的，而不是800，我们打开预置频道的DB数据查看确定是800，而用串口切到DTV 是让它跳入到1台，此时没有找到台号为1的频道，导致无法进入DTV。      
* 解决方法 
    > 泰霖重新搜台，重新预置
* 修改路径 
    > kernel/linux-kdriver2.git /tvscalercontrol/scaler
* 总结 
    > 7月份的试产才报出问题，之前试产批次都未测试最大亮度，新机芯自测白平衡时，需要勾选最大亮度

***
### 泰霖反馈切换ID 导致DVB_S无信号，需要重新预制频点，并且预制以后需要重启才能生效问题【2022-05-14】
***

* 问题分析
    > 首先跟工厂确定工厂信号是否有变动，显示的频道列表是否正常，在不重启的情况下是否正常，以及在HDMI频道下频道频点，等排除的情况下依然有问题，经过排查最终定位在切ID时会把分区下的tvdata 数据清除，这样会导致切id后db 数据找到，无法播放，只有重新预制频才能正常。      
* 解决方法 
    > 2022-5-13日康德恩解决此问题，切ID 不清楚tvdata 数据并导入量产分支
* 注意事项 
    > * 1、切了id，记得shop后在预置频道，
    > * 2、在HDMI频道下进入工厂菜单频道频点，

***
### 泰霖反馈遥控器按键TV屏幕响应正常，但串口工具发关命令返回值异常，但重新关闭再打开P模式以后则都正常的问题【2022-04-22】
***

* 问题分析
    > 初次反馈为必现，我们怀疑是不是工厂菜单启动过早打开P模式所导致，我们了延时3秒打开P模式。必现变成概率性。所以可以确定是P模式内部出现问题，经过中间排查，发现在按键返回监听事件被重复注册两次，导致第一个注册的被第二个覆盖，导致第一个无返回值。      
* 解决方法 
    > 合并监听事件
* 调用流程 
    > 中间件调用流程->UartService ->AppUart ->FactoryUart-> startUartThread() - > UartCommunication () -> transferData()->getRemoteCode()

***
### 41A工厂抄KEY 工具无法抄 widevine 等KEY 失败，导致prime video 片源无法播放等问题【2022-05-11】
***

* 问题分析
    > 首先已确定工厂抄KEY 工具的订单正确，所以我们服务器获取的KYE正常。查看板卡，发现有被重新焊过的痕迹，说明IC 或才EMMC 是旧的，有可能之前已抄过key ，经跟RTK 确认，KEY 一旦抄过无法清除，而且新的IC和新的EMMC一旦抄过key，就会相互绑定。绑定过后更换IC 或者更换其它机器上已经抄过key 的EMMC，会导致抄widevine等  key 失败。更换新的EMMC 不影响      
* 解决方法 
    > 换新的EMMC,重新跟IC配对绑定




## -----------------------------------排查方法----------------------------
***

### 串口抄失败
> * 1、查看Key 大小是否正确
> * 2、查看mnt/verdor/impdata 是否成功
> * 3、如果是RMCA key 则查看mnt/verdor/impdata/RMCA_ready 与mnt/verdor/tclconfig/pre_key/RMCA 中是否匹配
> * 4、有时接信源烧key有时会NG，拔掉信号线就可以烧录成功了(Attestation key 比较大，会出现这个问题)
> * 5、可以夹版本排查问题



### 预置频道注意事项
> * 1、切了id，记得shop后在预置频道。


### 白平衡调试
> * 1、所有串口第一步都要先进入工厂模式
> * 2、全部命令选择——>内置PATTERN 切换
> * 3、执行命令选择——>内置PATTERN 切换
> * 4、串口命令预览——>数据1表示打开白平衡调试，0表示关闭
